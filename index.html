<!doctype html>
<html lang="en">

<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Focus Timer</title>
<link rel="icon" type="image/png" href="favicon.png">

<style>
:root {
  --accent:#ffd54f;
  --btn-bg:var(--accent);
  --btn-color:#000;
  --text:#fff;
  --muted:#cfcfcf;
  --card-bg:rgba(0,0,0,0.45);
  --radius:14px;
}
*{box-sizing:border-box}
html,body{
  height:100%;margin:0;font-family:Inter,system-ui,-apple-system,"Segoe UI",sans-serif;
  background:#6ec9ff;color:var(--text);transition:background .3s ease;
}
header{display:flex;align-items:center;justify-content:space-between;padding:12px 18px}
nav{display:flex;gap:8px}
.tab-btn{padding:8px 12px;border:none;border-radius:10px;background:transparent;color:var(--muted);cursor:pointer;font-weight:700;transition:.25s cubic-bezier(.2,.9,.2,1)}
.tab-btn.active{background:var(--btn-bg);color:var(--btn-color)}
main{display:flex;align-items:center;justify-content:center;position:relative;height:calc(100% - 96px)}
.view{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;opacity:0;transform:translateY(8px) scale(.99);pointer-events:none;transition:.42s cubic-bezier(.2,.9,.2,1)}
.view.show{opacity:1;transform:translateY(0) scale(1);pointer-events:auto}
.timer-card{background:var(--card-bg);padding:18px;border-radius:var(--radius);text-align:center;box-shadow:0 8px 30px rgba(0,0,0,.5)}
.timer-display{font-size:12vw;font-weight:800;margin:6px 0;cursor:pointer}
.controls{margin-top:14px;display:flex;gap:8px;justify-content:center;flex-wrap:wrap}
.btn{border-radius:10px;padding:8px 12px;border:none;cursor:pointer;font-weight:700;transition:.25s cubic-bezier(.2,.9,.2,1)}
.btn.primary{background:var(--btn-bg);color:var(--btn-color)}
footer{display:flex;justify-content:space-between;align-items:center;padding:10px 16px;font-size:14px;color:var(--muted)}
input[type="number"]{border-radius:8px;padding:6px 8px;border:none;background:rgba(255,255,255,0.05);color:var(--text);width:72px}
.world-list{display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:10px;max-width:900px;width:100%}
.city-card{background:rgba(255,255,255,0.05);padding:10px;border-radius:8px}
#dinoCanvas{background:transparent;border-radius:12px;box-shadow:0 10px 30px rgba(0,0,0,.5);max-width:100%;height:200px}
.todo-wrap{max-width:760px;width:100%;background:rgba(255,255,255,0.05);padding:14px;border-radius:12px}
.todo-input{display:flex;gap:8px}
.todo-input input{flex:1;padding:10px;border-radius:8px;border:none;background:rgba(255,255,255,0.08);color:var(--text)}
.todo-item{display:flex;align-items:center;gap:8px;padding:8px;border-radius:8px;background:rgba(255,255,255,0.04)}
.todo-item.completed{text-decoration:line-through;opacity:.6}
.small{font-size:13px;color:var(--muted)}
html,body{overflow:hidden}
button{transition:all .25s ease;transform:translateY(0)}
button:hover{transform:translateY(-3px);box-shadow:0 4px 12px rgba(0,0,0,.2)}
</style>

<header>
  <nav>
    <button class="tab-btn active" id="tabClock">Clock</button>
    <button class="tab-btn" id="tabTimer">Timer</button>
    <button class="tab-btn" id="tabWorld">World</button>
    <button class="tab-btn" id="tabDino">Dino</button>
    <button class="tab-btn" id="tabTodo">To-Do</button>
  </nav>
  <div id="modeBadge">FOCUS</div>
</header>

<main>
  <section id="viewClock" class="view show"><div id="clockView" style="font-size:8vw;font-weight:800"></div></section>

  <section id="viewTimer" class="view">
    <div class="timer-card">
      <div id="sessionLabel">Focus session</div>
      <div id="timer" class="timer-display">25:00</div>
      <div class="controls">
        <button id="startBtn" class="btn primary">Start</button>
        <button id="resetBtn" class="btn">Reset</button>
        <button id="fullscreenBtn" class="btn">Fullscreen</button>
        <button id="uploadBtn" class="btn">Upload BG</button>
        <button id="colorBtn" class="btn">Change Colors</button>
        <input type="file" id="bgFile" accept="image/*" style="display:none">
      </div>
    </div>
  </section>

  <section id="viewWorld" class="view">
    <div class="world-list" id="worldList"></div>
  </section>

  <section id="viewDino" class="view">
    <div style="display:flex;flex-direction:column;align-items:center;gap:12px">
      <canvas id="dinoCanvas"></canvas>
      <div class="small">Space/↑/Tap = Jump • R = Restart</div>
    </div>
  </section>

  <section id="viewTodo" class="view">
    <div class="todo-wrap">
      <div class="todo-input">
        <input id="todoInput" placeholder="Add a task & press Enter">
        <button id="addTodo" class="btn">Add</button>
      </div>
      <div id="todoList"></div>
    </div>
  </section>
</main>

<footer>
  <div>
    <label class="small">Focus <input type="number" id="focusMin" value="25"></label>
    <label class="small">Break <input type="number" id="breakMin" value="5"></label>
  </div>
  <div id="status" class="small">Ready</div>
</footer>
<script>
/* Tabs */
const tabs={Clock:["tabClock","viewClock"],Timer:["tabTimer","viewTimer"],World:["tabWorld","viewWorld"],Dino:["tabDino","viewDino"],Todo:["tabTodo","viewTodo"]};
function showTab(n){
  Object.values(tabs).forEach(([b,v])=>{
    document.getElementById(b).classList.remove("active");
    document.getElementById(v).classList.remove("show");
  });
  const [btn,view]=tabs[n];
  document.getElementById(btn).classList.add("active");
  setTimeout(()=>document.getElementById(view).classList.add("show"),10);
}
for(const k in tabs){document.getElementById(tabs[k][0]).onclick=()=>showTab(k)}
showTab("Timer"); // ✅ Timer is now default

/* Clock */
const clockView=document.getElementById("clockView");
setInterval(()=>clockView.textContent=new Date().toLocaleTimeString(),500);

/* World Clock */
const cities=[["New York","America/New_York"],["London","Europe/London"],["Paris","Europe/Paris"],["Dubai","Asia/Dubai"],["Mumbai","Asia/Kolkata"],["Tokyo","Asia/Tokyo"],["Sydney","Australia/Sydney"]];
const list=document.getElementById("worldList");
function updateWorld(){list.innerHTML=cities.map(([n,tz])=>`<div class='city-card'><div>${n}</div><div>${new Intl.DateTimeFormat([], {hour:'2-digit',minute:'2-digit',second:'2-digit',hour12:false,timeZone:tz}).format(new Date())}</div></div>`).join('')}
setInterval(updateWorld,1000);updateWorld();

/* Timer */
let focusMin=document.getElementById("focusMin"),breakMin=document.getElementById("breakMin"),timerEl=document.getElementById("timer");
let startBtn=document.getElementById("startBtn"),resetBtn=document.getElementById("resetBtn"),uploadBtn=document.getElementById("uploadBtn"),colorBtn=document.getElementById("colorBtn"),bgFile=document.getElementById("bgFile");
let isFocus=true,isRunning=false,remaining=25*60,timerInt;
function fmt(s){const m=Math.floor(s/60),x=s%60;return`${m.toString().padStart(2,"0")}:${x.toString().padStart(2,"0")}`}
function update(){timerEl.textContent=fmt(remaining)}
function beep(){try{const a=new(AudioContext||webkitAudioContext)(),o=a.createOscillator(),g=a.createGain();o.connect(g);g.connect(a.destination);o.type="sine";o.frequency.setValueAtTime(880,a.currentTime);g.gain.setValueAtTime(.1,a.currentTime);o.start();o.stop(a.currentTime+.3);}catch{}}
function tick(){if(!isRunning)return;remaining--;update();if(remaining<0){beep();isFocus=!isFocus;remaining=(isFocus?+focusMin.value:+breakMin.value)*60;document.getElementById("modeBadge").textContent=isFocus?"FOCUS":"BREAK";}}

/* Hide/Show Controls */
function hideControls(){
  document.querySelectorAll(".controls .btn").forEach(btn=>{
    if(btn.id!=="startBtn") btn.style.display="none";
  });
}
function showControls(){
  document.querySelectorAll(".controls .btn").forEach(btn=>btn.style.display="");
}

/* Start/Pause + Reset */
function startPause(){
  if(!isRunning){
    isRunning=true;
    startBtn.textContent="Pause";
    timerInt=setInterval(tick,1000);
    hideControls(); // hide all other buttons when running
  } else {
    isRunning=false;
    clearInterval(timerInt);
    startBtn.textContent="Start";
    showControls();
  }
}
function reset(){
  isRunning=false;
  clearInterval(timerInt);
  isFocus=true;
  remaining=focusMin.value*60;
  startBtn.textContent="Start";
  update();
  showControls();
}
startBtn.onclick=startPause;
resetBtn.onclick=reset;
timerEl.onclick=startPause;
update();

/* === Background Saver === */
uploadBtn.onclick = () => bgFile.click();
bgFile.onchange = e => {
  const f = e.target.files[0];
  if (!f) return;
  const r = new FileReader();
  r.onload = x => {
    const imgData = x.target.result;
    document.body.style.background = `url(${imgData}) center/cover no-repeat`;
    localStorage.setItem("bgImage", imgData);
  };
  r.readAsDataURL(f);
};
window.addEventListener("load", () => {
  const savedBg = localStorage.getItem("bgImage");
  if (savedBg) document.body.style.background = `url(${savedBg}) center/cover no-repeat`;
});

/* === Color Theme Saver === */
colorBtn.onclick = () => {
  const btnBg = prompt("Enter button background color (#hex or name):", getComputedStyle(document.documentElement).getPropertyValue("--btn-bg").trim());
  if (!btnBg) return;
  const btnText = prompt("Enter button text color (#hex or name):", getComputedStyle(document.documentElement).getPropertyValue("--btn-color").trim());
  if (!btnText) return;
  const globalText = prompt("Enter overall page text color (#hex or name):", getComputedStyle(document.documentElement).getPropertyValue("--text").trim());
  if (!globalText) return;
  document.documentElement.style.setProperty("--btn-bg", btnBg);
  document.documentElement.style.setProperty("--btn-color", btnText);
  document.documentElement.style.setProperty("--text", globalText);
  localStorage.setItem("themeColors", JSON.stringify({btnBg,btnText,globalText}));
};
window.addEventListener("load", () => {
  const saved = localStorage.getItem("themeColors");
  if (saved) {
    const {btnBg,btnText,globalText}=JSON.parse(saved);
    document.documentElement.style.setProperty("--btn-bg", btnBg);
    document.documentElement.style.setProperty("--btn-color", btnText);
    document.documentElement.style.setProperty("--text", globalText);
  }
});

/* === Todo Saver === */
const todoInput=document.getElementById("todoInput"),addTodo=document.getElementById("addTodo"),todoList=document.getElementById("todoList");
let todos=JSON.parse(localStorage.getItem("todos")||"[]");
function renderTodos(){
  todoList.innerHTML="";
  todos.forEach((t,i)=>{
    const d=document.createElement("div");
    d.className="todo-item"+(t.done?" completed":"");
    d.innerHTML=`<input type='checkbox' ${t.done?"checked":""} data-i='${i}'>${t.text}<button class='btn small' data-i='${i}'>Del</button>`;
    todoList.appendChild(d);
  });
  todoList.querySelectorAll("input").forEach(cb=>cb.onchange=e=>{todos[e.target.dataset.i].done=e.target.checked;saveTodos();});
  todoList.querySelectorAll("button").forEach(b=>b.onclick=e=>{todos.splice(e.target.dataset.i,1);saveTodos();});
}
function saveTodos(){localStorage.setItem("todos",JSON.stringify(todos));renderTodos();}
addTodo.onclick=()=>{if(todoInput.value.trim()){todos.push({text:todoInput.value,done:false});todoInput.value="";saveTodos();}}
todoInput.onkeydown=e=>{if(e.key==="Enter")addTodo.click();}
renderTodos();

/* === Install Button Logic === */
let deferredPrompt;
const installBtn=document.getElementById("installBtn");
installBtn.style.display="none";

// Hide install button for desktop
if (!/Android|iPhone|iPad|iPod/i.test(navigator.userAgent)) {
  installBtn.remove(); // no install option on desktop
}

window.addEventListener("beforeinstallprompt", e=>{
  e.preventDefault();
  deferredPrompt=e;
  installBtn.style.display="block";
});

installBtn.addEventListener("click", async ()=>{
  installBtn.style.display="none";
  if(deferredPrompt){
    deferredPrompt.prompt();
    const {outcome}=await deferredPrompt.userChoice;
    if(outcome==="accepted"){
      localStorage.setItem("appInstalled","true");
    }
    deferredPrompt=null;
  }
});

// Hide button permanently if app already installed
if(localStorage.getItem("appInstalled")==="true"){
  installBtn.remove();
}

/* === Register Service Worker === */
if('serviceWorker' in navigator){
  window.addEventListener('load',()=>{
    navigator.serviceWorker.register('./service-worker.js');
  });
}
  
</script>

</html>
